name: 'Publish to Armada'
on:
  # schedule:
  #   # Runs every hour on the hour
  #   - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  check-links:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        repository: Synthetixio/js-monorepo
        token: ${{ secrets.TOKEN }}
    - run: |
        ls
        pwd
        cd v2/ui
        yarn install
        yarn build
        ls
        pwd
    - name: Publish armada release
      env:
        GITHUB_TOKEN: ${{ secrets.TOKEN }}
      run: |
        bundle_filename="$(npx --package=armada-cli@0.2.1 --yes armada bundle create ${{ inputs.bundle_name }} v2/ui/out)"
        
        hash="$(npx --package=armada-cli@0.2.1 --yes armada bundle checksum $bundle_filename)"

        checksum_filename="$filename_SHA256SUM"
        echo "$hash" > $checksum_filename

        gh release create release-test
        gh release upload release-test $bundle_filename
        gh release upload release-test $checksum_filename

        # TODO publish bundle